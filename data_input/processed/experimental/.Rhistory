## Wrapper of functions and pcks
#
# Erase all in memory
rm(list = ls())
list.of.packages <- c('tidyverse', 'data.table','cluster','gridExtra',
'ggthemes','grid','magrittr','latex2exp')
new.packages <- list.of.packages[!(list.of.packages %in%
installed.packages()[,"Package"])]
if (length(new.packages)) {
install.packages(new.packages)
}
# Load packages at once
sapply(list.of.packages, library, character.only = T)
## Source custom functions ----
path_functions = "~/Documentos/2019A/paper_gen_decrement/analysis/r"
setwd(path_functions)
# ==============================================================================
## For data wrangling and transformation
source("last_n_ses.r")
source("bind_all_ss.r")
source("read_sep_by_lever.r")
## Plotting utils
source("pub_theme.r")
source("axis_ticks.r")
source("sem_ul_lwl.r")
source("GeomStepHist.r")
source("resp_rate_df.r")
source("resp_norm_plot.r")
# Other utils
source("f_table.r")
source("get_bins.r")
source("expand-grid-jc.r")
## FWHM
source("fwhm.r")
## Kullback-Leibler divergence
source("kld_d.r")
## Optimal cluster computation with pam
source("bp_km.r") # principal
source("bp_km_wrap.r") # wrapper for subject-session-trial
source("pooled_ind_ana_km_df.r") # second wrapper for all data
## Individual trial analysis with Church et al 1994
source("lhl.r") # principal
source("lhl_wrapper.r") # wrapper per session
source("ind_ana_lhl.r") # for all data
"+" = function(x,y) {
if (is.character(x) || is.character(y)) {
return(paste(x , y, sep=""))
} else {
.Primitive("+")(x,y)
}
}
source("resp_times.r")
## FWHM
source("fwhm.r")
resp_times_Baseline <- bind_all_Ss(subjects_vec,
25,1,
path_read = paths[1]) %>%
resp_times(.,30)
source("~/Documentos/2019A/paper_gen_decrement/analysis/r/wrapper.r")
# Paths for processed data. Check raw2processed_proc.r ----
path_read.general = "~/Documentos/2019A/paper_gen_decrement/Data/"
path_read.BL = path_read.general + "processed/baseline"
path_read.EXP = path_read.general + "processed/experimental"
# Paths for results of analysis (data_results) ----
path_save.general = "~/Documentos/2019A/paper_gen_decrement/analysis/"
path_save.data = path_save.general + "data_results/"
# ETC
## vector of subjects numbers, used in several functions below
subjects_vec = 326:333
## Names of phases
ph_names = c("Baseline", "Experimental")
# Path of BL and EXP to read
paths = c(path_read.BL, path_read.EXP)
resp_times_Baseline <- bind_all_Ss(subjects_vec,
25,1,
path_read = paths[1]) %>%
resp_times(.,30)
resp_times_Baseline$phase <- ph_names[1]
resp_times_Experimental <- bind_all_Ss(subjects_vec,
25,1,
path_read = paths[2]) %>%
resp_times(.,30)
resp_times_Experimental$phase <- ph_names[2]
resp_times_df <- bind_rows(resp_times_Experimental,resp_times_Baseline)
View(fwhm)
fwhm_2phases <- resp_times_df %>%
group_by(sujeto, cde, phase,sesion)%>%
filter(length(bins) > 1) %>%
group_by(sujeto,cde,phase,sesion) %>%
summarise(
fwhm =
{
rt <- bins
rt <- rt[rt < 180]
d  <- data.frame(x = density(rt)$x,
y = density(rt)$y)
fwhm <- fwhm(d$x,d$y)$fwhm # custom function
if(length(fwhm) == 0 ) {
NA} else { fwhm }
},
peak =
{
rt <- bins
rt <- rt[rt < 180]
d  <- data.frame(x = density(rt)$x,
y = density(rt)$y)
mfw <- fwhm(d$x,d$y)$peak # custom function
if(length(mfw) == 0 ) {
NA} else { mfw }
}) %>% na.omit()
fwhm_2phases$cde <- fwhm_2phases$cde %>% as.factor
path_save.data
save(df_p_lhl,fwhm_2phases,file = path_save.data + "start_stop_fwhm_data.RData")
df_p_lhl <- ind_ana_lhl(list_ss = subjects_vec,
phases_names = ph_names,
paths = paths,
sessions = 20,
max_trials = 30,
trial_duration = 180) %>%
as.data.frame()
# Filter if rate in high rate is higher than the other states
df_p_lhl <- df_p_lhl %>%
filter(r1 < hrate & hrate > r3)
save(df_p_lhl,fwhm_2phases,file = path_save.data + "start_stop_fwhm_data.RData")
